<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equilibrio â€“ Bienestar Emocional</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: linear-gradient(135deg,#5f2c82,#49a09d);
  --card: rgba(255,255,255,0.18);
  --text: #ffffff;
  --glass: blur(18px);
}

body.dark {
  --bg: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}

body {
  margin:0;
  font-family: 'Inter', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height:100vh;
}

header {
  padding:20px;
  text-align:center;
  font-size:1.6rem;
  font-weight:600;
}

.container {
  padding:20px;
  max-width:1100px;
  margin:auto;
  display:grid;
  gap:20px;
}

.card {
  background:var(--card);
  backdrop-filter:var(--glass);
  border-radius:20px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,0.25);
  animation:fadeIn 0.6s ease;
}

h2 {
  margin-top:0;
}

textarea, input, select, button {
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  font-size:1rem;
}

button {
  background:#ffffff;
  color:#333;
  font-weight:600;
  cursor:pointer;
  transition:transform .2s;
}

button:hover { transform:scale(1.03); }

.chat-box {
  max-height:300px;
  overflow-y:auto;
  margin-bottom:10px;
}

.msg {
  margin:8px 0;
  padding:10px;
  border-radius:12px;
}

.user { background:rgba(0,0,0,0.3); }
.ai { background:rgba(255,255,255,0.3); color:#000; }

.toggle {
  position:fixed;
  top:15px;
  right:15px;
}

@keyframes fadeIn {
  from {opacity:0; transform:translateY(10px);}
  to {opacity:1; transform:translateY(0);}
}
</style>
</head>

<body>
<button class="toggle" onclick="toggleDark()">ðŸŒ™</button>

<header>Equilibrio â€“ Bienestar Emocional</header>

<div class="container">

<!-- CHAT IA -->
<div class="card">
<h2>ðŸ¤– Asistente Emocional</h2>
<div class="chat-box" id="chat"></div>
<textarea id="userInput" placeholder="Describe lo que sientes o piensas..."></textarea>
<button onclick="sendMessage()">Enviar</button>
</div>

<!-- DIARIO -->
<div class="card">
<h2>ðŸ“” Diario Emocional</h2>
<input type="number" id="mood" min="0" max="10" placeholder="Estado de Ã¡nimo (0-10)">
<button onclick="saveMood()">Guardar</button>
<canvas id="moodChart"></canvas>
</div>

<!-- TESTS -->
<div class="card">
<h2>ðŸ§ª Test PHQ-9 / GAD-7</h2>
<select id="testType">
  <option value="phq9">PHQ-9 (DepresiÃ³n)</option>
  <option value="gad7">GAD-7 (Ansiedad)</option>
</select>
<textarea id="testAnswers" placeholder="Introduce las puntuaciones (ej: 1,2,0,3...)"></textarea>
<button onclick="calcTest()">Calcular</button>
<p id="testResult"></p>
</div>

<!-- MINDFULNESS -->
<div class="card">
<h2>ðŸ§˜ Mindfulness</h2>
<p>RespiraciÃ³n 4-7-8: Inhala 4s Â· RetÃ©n 7s Â· Exhala 8s</p>
<button onclick="startBreathing()">Iniciar</button>
<p id="breath"></p>
</div>

<!-- CRISIS -->
<div class="card">
<h2>ðŸš¨ Ayuda Inmediata</h2>
<p>Si estÃ¡s en riesgo:</p>
<strong>TelÃ©fono de la Esperanza (EspaÃ±a): 717 003 717</strong>
<p>Emergencias: 112</p>
</div>

</div>

<script>
/* ---------- MODO OSCURO ---------- */
function toggleDark(){
 document.body.classList.toggle('dark');
 localStorage.setItem('dark',document.body.classList.contains('dark'));
}
if(localStorage.getItem('dark')==='true') toggleDark();

/* ---------- CHAT IA GEMINI ---------- */
const API_KEY="AIzaSyCy0MFctL-sHiVsRuQ_ZMDt7kmQ0Z632GA";
let memory = JSON.parse(localStorage.getItem('memory')||"[]");

function addMsg(text,cls){
 const div=document.createElement('div');
 div.className='msg '+cls;
 div.textContent=text;
 chat.appendChild(div);
 chat.scrollTop=chat.scrollHeight;
}

async function sendMessage(){
 const input=document.getElementById('userInput');
 if(!input.value) return;
 addMsg(input.value,'user');
 memory.push({role:"user",content:input.value});
 input.value="";

 const prompt = `
Eres un asistente de bienestar emocional basado en evidencia cientÃ­fica.
Objetivos:
- Identificar emociones especÃ­ficas
- Detectar distorsiones cognitivas (catastrofismo, todo/nada, personalizaciÃ³n, lectura de mente)
- Aplicar Terapia Cognitivo-Conductual
- Validar emociones con empatÃ­a genuina
- Formular preguntas socrÃ¡ticas
- Sugerir activaciÃ³n conductual y mindfulness
- Nunca repitas frases ni des diagnÃ³sticos

Contexto previo:
${memory.map(m=>m.content).join("\n")}
`;

 const res = await fetch(
 "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+API_KEY,
 {
 method:"POST",
 headers:{"Content-Type":"application/json"},
 body:JSON.stringify({
   contents:[{parts:[{text:prompt}]}]
 })
 });
 const data = await res.json();
 const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "No pude responder.";
 addMsg(reply,'ai');
 memory.push({role:"ai",content:reply});
 localStorage.setItem('memory',JSON.stringify(memory.slice(-10)));
}

/* ---------- DIARIO Y GRÃFICO ---------- */
let moods = JSON.parse(localStorage.getItem('moods')||"[]");

function saveMood(){
 const val=document.getElementById('mood').value;
 if(val==="") return;
 moods.push({date:new Date().toLocaleDateString(),value:+val});
 localStorage.setItem('moods',JSON.stringify(moods));
 drawChart();
}

function drawChart(){
 const ctx=document.getElementById('moodChart');
 new Chart(ctx,{
 type:'line',
 data:{
   labels:moods.map(m=>m.date),
   datasets:[{label:'Ãnimo',data:moods.map(m=>m.value)}]
 }
 });
}
drawChart();

/* ---------- TESTS ---------- */
function calcTest(){
 const arr=document.getElementById('testAnswers').value.split(',').map(n=>+n);
 const sum=arr.reduce((a,b)=>a+b,0);
 let interp="";
 if(document.getElementById('testType').value==="phq9"){
   interp = sum<5?"MÃ­nimo":sum<10?"Leve":sum<15?"Moderado":"Severo";
 } else {
   interp = sum<5?"MÃ­nimo":sum<10?"Leve":sum<15?"Moderado":"Severo";
 }
 document.getElementById('testResult').textContent =
 "PuntuaciÃ³n: "+sum+" Â· Severidad: "+interp;
}

/* ---------- RESPIRACIÃ“N ---------- */
function startBreathing(){
 const txt=document.getElementById('breath');
 txt.textContent="Inhala...";
 setTimeout(()=>txt.textContent="RetÃ©n...",4000);
 setTimeout(()=>txt.textContent="Exhala...",11000);
 setTimeout(()=>txt.textContent="Repite el ciclo conscientemente.",19000);
}
</script>
</body>
</html>
