<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Bienestar Emocional</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --bg: linear-gradient(135deg, #fff3ec, #fde2d6);
  --primary: #d96c4f;
  --secondary: #f1b7a1;
  --text: #3b2f2f;
  --card: #ffffff;
  --ai: #fdf1eb;
}

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 1rem;
  text-align: center;
  font-size: 1.3rem;
  font-weight: bold;
}

nav {
  display: flex;
  justify-content: space-around;
  background: var(--secondary);
  padding: 0.5rem;
}

nav button {
  background: none;
  border: none;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
}

section {
  display: none;
  padding: 1rem;
}

section.active {
  display: block;
}

.card {
  background: var(--card);
  padding: 1rem;
  border-radius: 16px;
  margin-bottom: 1rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

#chat {
  max-height: 55vh;
  overflow-y: auto;
  padding-bottom: 1rem;
}

.msg {
  max-width: 80%;
  margin-bottom: 0.6rem;
  padding: 0.6rem 0.8rem;
  border-radius: 14px;
  animation: fadeIn 0.3s ease;
}

.user {
  margin-left: auto;
  background: var(--primary);
  color: white;
}

.ai {
  margin-right: auto;
  background: var(--ai);
}

textarea {
  resize: none;
}

button.primary {
  background: var(--primary);
  color: white;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

.mood {
  font-size: 2rem;
  cursor: pointer;
  margin: 0.3rem;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<header>ğŸŒ¿ Bienestar Emocional</header>

<nav>
  <button onclick="showSection('chatSection')">ğŸ’¬ Chat IA</button>
  <button onclick="showSection('techniquesSection')">ğŸ§˜ TÃ©cnicas</button>
  <button onclick="showSection('moodSection')">ğŸ˜Š Ãnimo</button>
  <button onclick="showSection('privacySection')">ğŸ”’ Privacidad</button>
</nav>

<!-- CHAT -->
<section id="chatSection" class="active">
  <div class="card" id="chat"></div>
  <textarea id="userInput" rows="2" placeholder="Escribe cÃ³mo te sientes..."></textarea>
  <button class="primary" onclick="sendMessage()">Enviar</button>
</section>

<!-- TÃ‰CNICAS -->
<section id="techniquesSection">
  <div class="card">
    <h3>RespiraciÃ³n 4â€“6</h3>
    <p>Inhala 4 segundos, exhala 6 segundos. Repite por un minuto.</p>
    <button onclick="startBreathing()">Iniciar</button>
    <p id="breathing"></p>
  </div>
</section>

<!-- ÃNIMO -->
<section id="moodSection">
  <div class="card">
    <h3>Â¿CÃ³mo te sientes ahora?</h3>
    <div>
      <span class="mood" onclick="saveMood(1)">ğŸ˜</span>
      <span class="mood" onclick="saveMood(2)">ğŸ˜</span>
      <span class="mood" onclick="saveMood(3)">ğŸ™‚</span>
      <span class="mood" onclick="saveMood(4)">ğŸ˜Š</span>
    </div>
    <p id="moodLog"></p>
  </div>
</section>

<!-- PRIVACIDAD -->
<section id="privacySection">
  <div class="card">
    <p>Esta app no sustituye atenciÃ³n profesional.</p>
    <p>Si estÃ¡s en crisis, busca ayuda inmediata.</p>
  </div>
</section>

<script>
function showSection(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===== PROMPT SEGURO ===== */
const SYSTEM_PROMPT = `
Eres una asistente de bienestar emocional.
Responde en mÃ¡ximo 2â€“3 frases.
Valida la emociÃ³n primero.
No diagnostiques.
Haz como mÃ¡ximo una pregunta.
`;

/* ===== CRISIS ===== */
function isCrisis(text) {
  return ["suicid", "matarme", "no quiero vivir", "hacerme daÃ±o"]
    .some(w => text.toLowerCase().includes(w));
}

/* ===== CHAT ===== */
async function sendMessage() {
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  addMessage("user", text);
  input.value = "";

  if (isCrisis(text)) {
    addMessage("ai",
      "Siento que estÃ©s pasando por algo tan intenso. " +
      "Es importante que busques ayuda profesional o servicios de emergencia ahora mismo."
    );
    return;
  }

  const reply = await callGemini(text);
  addMessage("ai", reply);
}

function addMessage(role, text) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "msg " + role;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===== ENTER PARA ENVIAR ===== */
document.getElementById("userInput").addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

/* ===== GEMINI ===== */
async function callGemini(userText) {
      const API_KEY = "AIzaSyCy0MFctL-sHiVsRuQ_ZMDt7kmQ0Z632GA";
  try {
    const res = await fetch(
      `https://AIzaSyCy0MFcLL-sHiVsRWQ_ZMJt7KmQ0Z632GA.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [
            { role: "user", parts: [{ text: SYSTEM_PROMPT }] },
            { role: "user", parts: [{ text: userText }] }
          ]
        })
      }
    );

    const data = await res.json();
    return data.candidates[0].content.parts[0].text;

  } catch {
    const fallbacks = [
      "Gracias por compartir esto. Â¿QuÃ© es lo que mÃ¡s te pesa ahora?",
      "Suena a que ha sido un momento difÃ­cil. Estoy aquÃ­ para escucharte.",
      "Tiene sentido que te sientas asÃ­. Â¿Quieres contarme un poco mÃ¡s?"
    ];
    return fallbacks[Math.floor(Math.random() * fallbacks.length)];
  }
}

/* ===== RESPIRACIÃ“N ===== */
function startBreathing() {
  const el = document.getElementById("breathing");
  let steps = ["Inhalaâ€¦", "Exhalaâ€¦"];
  let i = 0;
  const interval = setInterval(() => {
    el.textContent = steps[i % 2];
    i++;
    if (i > 6) clearInterval(interval);
  }, 5000);
}

/* ===== ÃNIMO ===== */
function saveMood(v) {
  const d = new Date().toLocaleString();
  localStorage.setItem("mood", `${v} â€“ ${d}`);
  document.getElementById("moodLog").textContent =
    "Ãšltimo registro: " + localStorage.getItem("mood");
}
</script>

</body>
</html>
